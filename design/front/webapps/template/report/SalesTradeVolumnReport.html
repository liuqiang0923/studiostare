<!DOCTYPE html>
<html>
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
	<meta name="viewport" content="width=720, initial-scale=1.0, user-scalable=0, minimum-scale=1.0, maximum-scale=1.0">
	<meta name="apple-mobile-web-app-capable" content="yes">
	<meta name="apple-mobile-web-app-status-bar-style" content="black">
	<title>Sales Report</title>
	
	<link rel="stylesheet" type="text/css" href="../../css/style.css" media="screen" />
	<script src="/js/util.js"></script>
	<script src="/js/page.js"></script>
	<script src="/js/calendar.js"></script>
	<script src="/js/zepto.min.js"></script>
	<script language="javascript"> 
		var sid = '${sessionId}';
	    function loadReport(pageNo) {
	    	pageNo = isNaN(parseInt(pageNo)) ? 1 : pageNo;
	    	var communityId = parseInt(getValue('communityId'));
	    	
	    	if (!communityId) return;
	    	
	    	var startAt = getValue("startAt");
	    	var endAt = getValue("endAt");
	    	
	    	var data = '{"body":{"communityid":"'+communityId+'","pageno":"'+pageNo+'"';
	    	data += ',"orderby":"'+lastOrderBy+'","startat":"'+startAt+'","endat":"'+endAt+'"}}'
	    	
	    	progress(1);
	    	$.ajax({type: "POST",dataType: "json",
		        url: '/spi/querySaleTradeVolume.do?ss='+sid,
		        data: data,
		        success: function(data){ 
			        buildReport(data);
		        }
		    });
	    }
	    function buildReport(data) {
	    	progressReset();
	    	var rpttable = byId('rpttable');
	    	var rows = rpttable.rows;
	    	for (var i=rows.length-1; i>0; i--) {
	    		rpttable.deleteRow(i);
	    	}
	    	clearPageBar('pagenav');
	    	
	    	var reports = data.reports;
	    	if (reports && reports.length>0) {
	    		for (var i=0;i<reports.length;i++) {
	    			var row = rpttable.insertRow(rpttable.rows.length);
	    			var R = reports[i];
	    			var values = [R.date,R.communityname,R.tradecount,R.tradearea,R.tradeprice];
	    			appendCells(row, values);
	    		}
	    		
	    		var page= data.page;
	    		generatePageBar(page.pageno, page.totalpage, 'pagenav', 'loadReport');
	    	} else {
	    		var row = rpttable.insertRow(rpttable.rows.length);
	    		var cell = row.insertCell(0);
	    		cell.setAttribute('colspan',5);
	    		cell.innerHTML = '暂无交易记录';
	    	}
	    }
	    function appendCells(row, values) {
	    	for (var ci=0; ci<values.length; ci++) {
    			var cell = row.insertCell(ci);
    			cell.innerHTML = '<td>'+values[ci]+'</td>';
	    	}
	    }
	    var lastOrderBy = 'desc';
	    function setOrder(orderBy) {
	    	if (orderBy == lastOrderBy) return;
	    	
	    	lastOrderBy = orderBy;
	    	if (orderBy == 'asc') {
	    		byId('divasc').className = 'asc ativ';
	    		byId('divdesc').className = 'desc';
	    	} else {
	    		byId('divasc').className = 'asc';
	    		byId('divdesc').className = 'desc ativ';
	    	}
	    	loadReport(1);
	    }
	</script>
	
</head>
<body onload="loadReport()">
		<div class='datadiv'>
<div class="search">
 <div class="fl">
		<input type="text" name="startAt" id="startAt" readonly class='datepickr' 
			placeholder="开始日期" onclick='javascript:calendar.setHook(this)'>
		<input type="text" name="endAt" id="endAt" readonly class='datepickr' 
			placeholder="结束日期" onclick='javascript:calendar.setHook(this)'>
		<select name="communityId" id="communityId">
			<option value="0">-- 选择楼盘 --</option>
			<#if communities?exists>
				<#list communities as cm>
				<option value="${cm.id}">${cm.communityName}</option>
				</#list>
			</#if>
		</select>
		<div class="actionbtn1" onclick="cssclick(this,'actionbtn1','actionbtn2')">
			 <div class="searchbox"><a href=""  onclick="loadReport()"></a></div>
			<div id="progressbar" style="display:none"><div id='progressblock'></div></div>
		</div>
        </div>
		<div class="fr">
			<div class="txt">成交排序</div>
			<div class="asc" id="divasc" onclick="setOrder('asc')">升</div>
			<div class="desc ativ" id="divdesc" onclick="setOrder('desc')">降</div>
		</div>
	</div>
		<table id='rpttable' class="datatable_list" cellpadding="0" cellspacing="0">
			<tr>
				<th>日期</th>
				<th>楼盘</th>
				<th>成交套数</th>
				<th>成交面积（平方米）</th>
				<th>成交金额（万元）</th>
			</tr>
		</table>
        	<div id='pagenav' class='pagenav'></div>

	</div>
</body>